!function(){var a,s,f,h,t,d;function m(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}f=function(t,e){return d.__node&&"undefined"!=typeof fs&&null!==fs&&!/^https?:/.exec(t)?new Promise(function(n,r){return fs.readFile(t,function(t,e){return t?r(t):n(e.toString())})}):fetch(t,e).then(function(i){var t;return i&&i.ok?i.text():i?i.clone().text().then(function(t){var e,n=i.status||404,r=new Error(n+" "+t);r.name="lderror",r.id=n,r.message=t,n=r;try{(e=JSON.parse(t))&&"lderror"===e.name&&(m(n,e).json=e)}catch(t){0}return Promise.reject(n)}):Promise.reject(((t=new Error("404")).name="lderror",t.id=404,t))})},(h=function(t){var e,n,r,i,o=this;return this.lc=(t=null==t?{}:t).context||{},this.id=Math.random().toString(36).substring(2),t.iframe?this.iframe=t.iframe:(this.iframe=e=s.createElement("iframe"),(n=e.style).position="absolute",n.top=0,n.left=0,n.width=0,n.height=0,n.pointerEvents="none",n.opacity=0,e.setAttribute("title","rescope script loader"),e.setAttribute("name","pdb-proxin-"+this.id),e.setAttribute("sandbox","allow-same-origin allow-scripts"),s.body.appendChild(e)),r=Object.fromEntries(Reflect.ownKeys(this.iframe.contentWindow).map(function(t){return[t,!0]})),i={},this._proxy=new Proxy(t.target||a,{get:function(t,e,n){return null!=o.lc[e]?o.lc[e]:null!=i[e]?i[e]:"function"==typeof t[e]?i[e]=t[e].bind(t):null!=r[e]?t[e]:void 0},set:function(t,e,n){return r[e]?t[e]=n:o.lc[e]=n,!0},defineProperty:function(t,e,n){return Object.defineProperty(o.lc,e,n),o._proxy}}),this}).prototype=((t=Object.create(Object.prototype)).proxy=function(){return this._proxy},t.ctx=function(){return this.lc},t),(d=function(t){var e,n;return null==t&&(t={}),this.id=Math.random().toString(36).substring(2),this.iframe=e=s.createElement("iframe"),this._cache={},this.proxy=new h,this.registry(t.registry||"/assets/lib/"),(n=e.style).position="absolute",n.top=0,n.left=0,n.width=0,n.height=0,n.pointerEvents="none",n.opacity=0,e.setAttribute("title","rescope script loader"),e.setAttribute("name","pdb-rescope-"+this.id),e.setAttribute("sandbox","allow-same-origin allow-scripts"),s.body.appendChild(e),e.contentWindow.document.body.innerHTML=(t.preloads||[]).map(function(t){return'<script type="text/javascript" src="'+t+'"><\/script>'}).join(""),this}).env=function(t){t=[t,t.document];return a=t[0],s=t[1],t},d.prop={legacy:{webkitStorageInfo:!0}},d.id=function(t){var e=t.path||("js"===t.type?"index.min.js":"css"===t.type?"index.min.css":"index.html");return t.id||t.url||(t.ns?t.ns+":":"")+t.name+"@"+(t.version||"main")+":"+e},d._cache={},d._ver={map:{},list:{}},d.cache=function(t){var e,n,r,i,o,s,c,u,l,p,a;if((t="string"==typeof t?{url:t}:t).id||(t.id=d.id(t)),e=this._cache[t.id])return e;if(t.id&&!t.name?((o=t.id.split(":")).length<=2?(n=o[0],r=o[1],i=o[2]):(i=o[0],n=o[1],r=o[2]),s=(o=(o=/^(@?[^@]+)(?:@([^:]+))?$/.exec(n))||["",t.id,""])[1],c=o[2]):(i=(u=[t.ns,t.name,t.version||"",t.path||""])[0],s=u[1],c=u[2],r=u[3]),/^[0-9.]+$/.exec(c)){if((e=((u=this._ver.map)[s]||(u[s]={}))[c])&&(c=e),e=this._cache[d.id({ns:i,name:s,version:c,path:r})])return e;for(l=0,p=((u=this._ver.list)[s]||(u[s]=[])).length;l<p;++l)if(a=l,a=this._ver.list[s][a],semver.fit(a,c)&&(this._ver.map[s][c]=a,t.id=d.id({ns:i,name:s,version:a,path:r}),e=this._cache[t.id]))return e}return function(t,e){var n=-1,r=e.length>>>0;for(;++n<r;)if(t===e[n])return 1;return}(c,(u=this._ver.list)[s]||(u[s]=[]))||this._ver.list[s].push(c),this._cache[t.id]=t},d.prototype=((t=Object.create(Object.prototype)).peekScope=function(){return!1},t.init=function(){return Promise.resolve()},t._ref=function(t){var e,n;return"string"==typeof t&&(t={url:t}),"function"==typeof(e=this._reg.url||this._reg)&&((n=m({},t)).url=e(t),t=n),this._reg.fetch?this._reg.fetch(t):t.url},t.registry=function(t){return"string"==typeof t?("/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),this._reg=(e=t,function(t){return e+"/"+t.name+"/"+(t.version||"main")+"/"+(t.path||"index.min.js")})):this._reg=t;var e},t.cache=function(t){var e;return(t="string"==typeof t?{url:t}:t).id||(t.id=d.id(t)),(e=this._cache[t.id])||(this._cache[t.id]=d.cache(t))},t.exports=function(t){var e,n,r=[],i=(t=null==t?{}:t).ctx||{},t="string"==typeof t.libs?[t.libs]:t.libs||[],o=(e=[{},this.iframe.contentWindow])[0],s=e[1];for(n in i)o[n]=s[n],s[n]=i[n];for(n in this._exports(t,0,i),o)r.push(s[n]=o[n]);return r},t._exports=function(t,e,n){var r,i,o,s,c,u,l=[];if(null==n&&(n={}),r=t[e=null==e?0:e]){if(i=(u=[{},(r=this.cache(r)).fprop,this.iframe.contentWindow])[0],o=u[1],s=u[2],o)for(c in o)i[c]=s[c],s[c]=o[c];else if(r.fprop=o={},r.prop={},r.propIniting=!0,r.gen)m(o,r.gen.apply(s,[s,s,s])),r.prop=Object.fromEntries(function(){var t=[];for(c in o)t.push([c,null]);return t}());else{for(c in Object.fromEntries(Reflect.ownKeys(s).filter(function(t){return!d.prop.legacy[t]}).map(function(t){return[t,!0]})))i[c]=s[c];try{s.eval((r.code||"").replace('"use strict";',""))}catch(t){throw u=t,console.error("[@plotdb/rescope] Parse failed",{url:r.url,ns:r.ns,name:r.name,version:r.version,path:r.path}),console.error("[@plotdb/rescope] with this error:",u),u}for(c in Object.fromEntries(Reflect.ownKeys(s).filter(function(t){return!d.prop.legacy[t]}).map(function(t){return[t,!0]})))s[c]!==i[c]&&"NaN"!==c&&(o[c]=s[c],r.prop[c]=null)}for(c in o)n[c]=o[c];for(c in this._exports(t,e+1),o)l.push(s[c]=i[c]);return l}},t._wrap=function(t,e,n){var r,i,o;for(o in null==e&&(e={}),null==n&&(n={}),i="var window, global, globalThis, self, __ret = {}; __win = {};\nwindow = global = globalThis = self = window = scope;",r=(t=null==t?{}:t).prop||{})i+="var "+o+"; __win['"+o+"'] = win['"+o+"']; win['"+o+"'] = undefined;";for(o in e)i+="var "+o+" = window['"+o+"'] = ctx['"+o+"'];";for(o in i+=t.code+";",r)i+="if(!("+o+")) { "+o+" = scope['"+o+"']; }\n__ret['"+o+"'] = "+o+" || window['"+o+"'] || win['"+o+"'] || this['"+o+"'];\nwin['"+o+"'] = __win['"+o+"'];";return i+="return __ret;",n.codeOnly?"function(scope, ctx, win){"+i+"}":new Function("scope","ctx","win",i)},t.load=function(t,r,i,o){var e,s,c,u,l,p=this;return null==r&&(r={}),null==i&&(i=!1),null==o&&(o=!1),e=(t=(Array.isArray(t)?t:[t]).map(function(t){return p.cache(t)})).px||(t.px=r&&r.p?r.p:new h),s=e.ctx(),c=e.proxy(),u=[t],(l=function(t){var e,n;return(e=u[t=null==t?0:t])?(n=e.map(function(e){var t;return!e.code&&!e.gen||i?(t=p._ref(e)).then?t.then(function(t){return e.code=t.content,p.cache((e.id=void 0,e.version=t.version,e.code=t.content,e))}):f(t,{method:"GET"}).then(function(t){return e.code=t}):Promise.resolve()}),Promise.all(n).then(function(){if(!o)return p.exports({libs:e,ctx:r.f}),e.map(function(t){return t.propIniting&&(t.gen||(t.gen=p._wrap(t,s)),t.prop=t.gen.apply(c,[c,s,a]),t.propIniting=!1),m(s,t.prop)})}).then(function(){return s}).then(function(){return l(t+1)})):Promise.resolve(s)})(0)},t.context=function(t,e,n){var r;return"function"!=typeof e&&(e=(r=[n,e])[0],n=r[1]),this.load(t,n).then(function(t){return e?e(t):t})},t),d.env("undefined"!=typeof self&&null!==self?self:globalThis),d.proxin=h,d.dualContext=function(){return{p:new h,f:{},ctx:function(){return this.p.ctx()}}},"undefined"!=typeof module&&null!==module?module.exports=d:"undefined"!=typeof window&&null!==window&&(window.rescope=d)}();
